---
import { AppHeader } from '../components/app-header'
import Dashboard from '../components/astro/Dashboard.astro'
import { WEB_FEATURES } from '../constants/web-features'
import featureIdsData from '../data/feature-ids.json'
import featuresData from '../data/features.json'
import Layout from '../layouts/Layout.astro'

// Build-time data loading from pre-fetched JSON
const allFeatures = (featuresData.features ??
  []) as import('../types').FeatureData[]
const allFeatureIds = (featureIdsData.ids ?? []) as string[]
const buildTimestamp = (featuresData.buildTimestamp ??
  new Date().toISOString()) as string

// Pre-render a subset of features (default list)
const featureIdsSet = new Set(WEB_FEATURES as readonly string[])
const features = allFeatures.filter(f => featureIdsSet.has(f.id))
---

<Layout
  features={features}
  buildTimestamp={buildTimestamp}
  allFeatures={allFeatures}
  allFeatureIds={allFeatureIds}
>
  <AppHeader />

  <Dashboard
    features={features}
    suggestedFeatureIds={allFeatureIds}
    allFeatures={allFeatures}
  />
</Layout>
